<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SmartBiz Assistance</title>
    <meta name="description" content="SmartBiz Assistance — simplify your business with smart tools." />

    <!-- SPA base: routes & assets ziwe absolute (/assets/...) -->
    <base href="/" />

    <!-- Color scheme + adaptive theme-color (light/dark) -->
    <meta name="color-scheme" content="dark light" />
    <meta name="theme-color" content="#0b1220" media="(prefers-color-scheme: dark)" />
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />

    <!-- Icons & manifest (absolute paths) -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0d47a1" />
    <meta name="msapplication-TileColor" content="#0d47a1" />
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials" />

    <!-- Social cards -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="SmartBiz Assistance" />
    <meta property="og:description" content="Simplify your business with smart tools." />
    <meta property="og:url" content="https://smartbizsite.netlify.app/" />
    <meta property="og:image" content="/og-image.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="SmartBiz Assistance" />
    <meta name="twitter:description" content="Simplify your business with smart tools." />
    <meta name="twitter:image" content="/og-image.png" />

    <!-- Perf: preconnect to API origin (salama) -->
    <link rel="preconnect" href="https://smartbiz-backend-p45m.onrender.com" crossorigin />

    <!-- Debug only (unaweza kuondoa kwenye prod) -->
    <meta http-equiv="Cache-Control" content="no-store" />

    <style>
      :root{
        --bg:#000; --fg:#fff; --muted:#b3b3b3;
        --ring:#9fa8ff; --ring-offline:#f59e0b; --ring-route:#22d3ee;
        --btn:#2563eb; --btn-fg:#fff; --btn-hover:#1e40af
      }
      @media (prefers-color-scheme: light){
        :root{ --bg:#ffffff; --fg:#0b1220; --muted:#5b6472; }
      }
      html,body,#app{ height:100% }
      body{
        margin:0; background:var(--bg); color:var(--fg);
        font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
        -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility;
      }
      #app{ display:grid; place-items:center }
      .sb-loader{ display:flex; flex-direction:column; align-items:center; gap:12px; opacity:.95 }
      .sb-ring{ width:44px; height:44px; border:3px solid #ffffff33; border-top-color:var(--ring); border-radius:50%; animation:sb-spin 1s linear infinite }
      @keyframes sb-spin{ to{ transform:rotate(360deg) } }
      .sb-note{ color:var(--muted); font-size:14px }
      body.offline .sb-ring{ border-top-color:var(--ring-offline) }
      body.route-loading .sb-ring{ border-top-color:var(--ring-route) }
      @media (prefers-reduced-motion: reduce){ .sb-ring{ animation-duration:2s } }
      button.sb-btn{ background:var(--btn); color:var(--btn-fg); border:0; padding:.6rem 1rem; border-radius:.6rem; cursor:pointer }
      button.sb-btn:hover{ background:var(--btn-hover) }

      /* Debug overlay */
      #sb-debug{
        position:fixed; left:8px; right:8px; bottom:8px; max-height:42vh;
        overflow:auto; background:#0b1220; color:#9ef; padding:10px 12px;
        border:1px solid #234; border-radius:8px; font:12px/1.45 ui-monospace,monospace;
        z-index:2147483647; white-space:pre-wrap; display:none;
      }
      #sb-debug.show{ display:block }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="sb-loader" role="status" aria-live="polite">
        <div class="sb-ring" aria-hidden="true"></div>
        <div>Loading SmartBiz…</div>
        <div class="sb-note" id="sb-hint" aria-hidden="true"></div>
      </div>
      <noscript>
        <p style="color:#eee;background:#111;padding:.75rem 1rem;border-radius:.75rem;border:1px solid #333;margin-top:1rem;">
          JavaScript is required to run this app. Please enable JavaScript.
        </p>
      </noscript>
    </div>

    <pre id="sb-debug" aria-live="polite"></pre>

    <script>
      (function () {
        try{ document.documentElement.classList.remove('no-js'); document.documentElement.classList.add('js'); }catch(_){}

        // lang/dir
        try{
          var saved = localStorage.getItem('user_lang');
          var nav = (saved || (navigator.language||'en')).toLowerCase();
          var dir = /^(ar|fa|ur|he)\b/.test(nav) ? 'rtl' : 'ltr';
          document.documentElement.setAttribute('lang', nav.slice(0,2));
          document.documentElement.setAttribute('dir', dir);
        }catch(_){}

        // 100vh fix
        function setVH(){ try{
          var vh = (window.innerHeight||0)*0.01;
          document.documentElement.style.setProperty('--vh', vh+'px');
        }catch(_){} }
        setVH(); addEventListener('resize', setVH, {passive:true}); addEventListener('orientationchange', setVH, {passive:true});

        // Offline hint
        function setNetHint(){
          try{
            var h = document.getElementById('sb-hint'); if(!h) return;
            if (navigator.onLine) { document.body.classList.remove('offline'); h.textContent = '' }
            else { document.body.classList.add('offline'); h.textContent = 'You seem offline. Some features may pause.' }
          }catch(_){}
        }
        addEventListener('online', setNetHint); addEventListener('offline', setNetHint); setNetHint();

        // Debug overlay
        function dbg(){ var el=document.getElementById('sb-debug'); if(!el) return el; el.classList.add('show'); return el; }
        function log(){ var el=dbg(); if(!el) return; el.textContent += Array.from(arguments).map(String).join(' ')+'\n'; }
        addEventListener('error', function(e){ log('ERR:', e.message,'@', (e.filename||'').replace(location.origin,''),':',e.lineno||'',e.colno||''); if(e.error&&e.error.stack) log(e.error.stack) });
        addEventListener('unhandledrejection', function(e){ var r=e.reason||{}; log('REJ:', (r.message||r).toString()); if(r.stack) log(r.stack) });

        // Watchdog + SW cleanup
        var TIMEOUT_MS = 12000;
        setTimeout(function(){
          if(!window.__APP_MOUNTED__){
            var el=document.getElementById('app'); if(!el) return;
            el.innerHTML =
              '<div style="text-align:center;max-width:560px;margin:0 auto;padding:24px">' +
              '<div class="sb-ring" style="margin:0 auto 12px"></div>' +
              '<div style="font-weight:700;margin-bottom:8px">Still loading…</div>' +
              '<div class="sb-note" style="margin-bottom:12px">Try a hard refresh (Ctrl/Cmd + F5).</div>' +
              '<button class="sb-btn" id="sb-reload">Reload</button>' +
              '</div>';
            try{
              if('serviceWorker' in navigator){
                navigator.serviceWorker.getRegistrations().then(function(rs){ rs.forEach(function(r){ r.unregister() }) })
              }
              var btn=document.getElementById('sb-reload');
              if(btn) btn.addEventListener('click', function(){
                var u = new URL(location.href); u.searchParams.set('v', Date.now().toString()); location.replace(u.toString());
              });
            }catch(_){}
          }
        }, TIMEOUT_MS);

        // route-loading marker (router itatoa)
        addEventListener('sb:route:start', function(){ try{ document.body.classList.add('route-loading') }catch(_){}})
        addEventListener('sb:route:end',   function(){ try{ document.body.classList.remove('route-loading') }catch(_){}})
      })();
    </script>

    <script nomodule>
      document.getElementById('app').innerHTML =
        '<div style="max-width:560px;margin:2rem auto;color:#eee">' +
        '<h2>Unsupported browser</h2>' +
        '<p>Please update your browser to the latest version to use SmartBiz.</p>' +
        '</div>';
    </script>

    <!-- DEV entry; Vite atai-rewrite kuwa /assets/index-*.js wakati wa build -->
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
